{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% include "base/css.html" %}
    <title>Hello, world!</title>
  </head>
  <body>
  {% include "base/navbar.html" with brand_name="New NavBar"%}
  <div class="container">
  {% block content %}
  {% endblock %}
  </div>
  {% include "base/js.html" %}
  <script>
      $(document).ready(function () {
          let productForm = $(".form-product-ajax")
          productForm.submit(function (event) {
            event.preventDefault()
              let thisForm = $(this)
              let actionEndpoint = thisForm.attr("action")
              let httpMethod = thisForm.attr("method")
              let formData = thisForm.serialize()

              $.ajax({
                  url: actionEndpoint,
                  method: httpMethod,
                  data: formData,
                  success: function (data) {
                    console.log("success")
                    console.log(data)
                    let submitSpan = thisForm.find(".submit-span")
                    console.log(submitSpan.html())
                      if (data.added) {
                          submitSpan.html("<button type=\"submit\" class=\"btn btn-primary\">Remove from cart</button>")
                      } else {
                          submitSpan.html("<button type=\"submit\" class=\"btn btn-success\">Add to cart</button>")
                      }
                  },
                  error: function (errorData) {
                    console.log("error")
                    console.log(errorData)
                  }
              })
          })
      })
  </script>
  </body>
</html>